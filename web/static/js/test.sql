DROP DATABASE IF EXISTS frelanserh CASCADE;
CREATE DATABASE IF NOT EXISTS frelanserh;
SET DATABASE = frelanserh;

CREATE TABLE IF NOT EXISTS hv2_b7891567567 (
 pnv2_b78915325667 SERIAL PRIMARY KEY,
 pnv3_b78915325667 VARCHAR NOT NULL UNIQUE,
 pnv4_b78915325667 VARCHAR NOT NULL UNIQUE,
 about VARCHAR NOT NULL DEFAULT 'не указано',
 pnv5_b78915325667 VARCHAR NOT NULL DEFAULT 'не указано',
 pnv6_b78915325667 VARCHAR(15) NOT NULL DEFAULT 'не указано',
  pnv7_b78915325667   INT NOT NULL DEFAULT 0,
  pnv8_b78915325667r INT NOT NULL DEFAULT 0,
  pnv9_b78915325667 VARCHAR(25) NOT NULL,
  pnv10_b78915325667 VARCHAR(25) NOT NULL,
  pnv11_b78915325667 INT NOT NULL DEFAULT 0,
  pnv12_b78915325667 real NOT NULL DEFAULT 0,
  pnv13_b78915325667  VARCHAR(50) NOT NULL,
 pnv14_b78915325667 BOOLEAN NOT NULL DEFAULT true,
 pnv15_b78915325667 TIMESTAMP NOT NULL DEFAULT now(),
 pnv16_b78915325667 INT NOT NULL DEFAULT 0 CHECK (pnv16_b78915325667 >= 0),
 pnv18_b78915325667 INT NOT NULL DEFAULT 0 CHECK (pnv16_b78915325667 >= 0)
 );

   CREATE TABLE IF NOT EXISTS pnv19_b78915325667 (
    pnv2_b78915325667 SERIAL PRIMARY KEY,
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    pnv21_b78915325667 VARCHAR NOT NULL,
    spoiler_of pnv22_b78915325667,
    nsfw pnv23_b78915325667,
    likes_count pnv24_b78915325667 (likes_count >= 0),
    comments_count pnv25_b78915325667 (comments_count >= 0),
    created_at pnv26_b78915325667 TIMESTAMPTZ NOT NULL DEFAULT now(),
    tag VARCHAR NOT NULL, pnv27_b78915325667
    uspnv11_b78915325667 VARCHAR(8) NOT NULL, pnv28_b78915325667
    timeproj BOOLEAN  NOT NULL DEFAULT false,pnv29_b78915325667
    worktp BOOLEAN  NOT NULL DEFAULT false,pnv30_b78915325667
    hourtp BOOLEAN  NOT NULL DEFAULT false,pnv31_b78915325667
    amount INT NOT NULL DEFAULT 0, pnv32_b78915325667
    selecter BOOLEAN  NOT NULL DEFAULT false,pnv33_b78915325667
    deleted BOOLEAN  NOT NULL DEFAULT false,pnv34_b78915325667
    pnv7_b78915325667 INT NOT NULL,pnv35_b78915325667
    access INT NOT NULL, pnv36_b78915325667
    title VARCHAR(100)pnv37_b78915325667


 );
CREATE TABLE IF NOT EXISTS groups pnv51_b78915325667 (
    pnv2_b78915325667 SERIAL NOT NULL  PRIMARY KEY,
    theme VARCHAR NOT NULL,pnv38_b78915325667
    opis VARCHAR NOT NULL,pnv39_b78915325667
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,pnv40_b78915325667
    post_pnv2_b78915325667 BIGINT REFERENCES pnv19_b78915325667, pnv40_b78915325667
    closer  VARCHAR NOT NULL, pnv41_b78915325667
    pnv13_b78915325667GpUs VARCHAR NOT NULL DEFAULT md5(random()::text),pnv42_b78915325667
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now() pnv43_b78915325667
   

);

 CREATE TABLE IF NOT EXISTS  otzyv  pnv44_b78915325667(
     pnv2_b78915325667 SERIAL NOT NULL PRIMARY KEY,
     upnv2_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
     upnv2_b789153256672 SERIAL NOT NULL REFERENCES hv2_b7891567567 ,
     rating INT NOT NULL DEFAULT 0, pnv46_b78915325667
     value VARCHAR NOT NULL, pnv45_b78915325667
     created_at TIMESTAMP NOT NULL DEFAULT now(),
     CONSTRAINT order_unique UNIQUE (upnv2_b789153256672)
);


 select column_name,data_type 
from information_schema.columns 
where table_name = 'notifications';
 CREATE TABLE IF NOT EXISTS  follows (
     follwer_pnv2_b78915325667 INT NOT NULL REFERENCES hv2_b7891567567,
     follwee_pnv2_b78915325667 INT NOT NULL REFERENCES hv2_b7891567567,
     PRIMARY KEY (follwer_pnv2_b78915325667, follwee_pnv2_b78915325667)
 );
  CREATE TABLE IF NOT EXISTS  comments pnv47_b78915325667 (
     pnv2_b78915325667 SERIAL NOT NULL PRIMARY KEY,
     value VARCHAR NOT NULL,
     title VARCHAR NOT NULL,
     ppnv2_b78915325667 SERIAL ,
     upnv2_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
     pnv4_b78915325667 VARCHAR,
     gpnv2_b78915325667 SERIAL,
     selecter BOOLEAN NOT NULL DEFAULT false,
     created_at TIMESTAMP NOT NULL DEFAULT now()

);
 CREATE TABLE IF NOT EXISTS  orders pnv48_b78915325667 (
     pnv2_b78915325667 SERIAL NOT NULL PRIMARY KEY,
     ppnv2_b78915325667 SERIAL NOT NULL REFERENCES pnv19_b78915325667,
     upnv2_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
     gpnv2_b78915325667 SERIAL NOT NULL REFERENCES groups,
     created_at TIMESTAMP NOT NULL DEFAULT now()
);
CREATE TABLE IF NOT EXISTS post_likes pnv49_b78915325667(
    pnv20_b78915325667  SERIAL NOT NULL REFERENCES hv2_b7891567567,
    post_pnv2_b78915325667 SERIAL NOT NULL REFERENCES pnv19_b78915325667,
    PRIMARY KEY (pnv20_b78915325667, post_pnv2_b78915325667)

);
CREATE TABLE IF NOT EXISTS user_rating user_pnv46_b78915325667(
    pnv20_b78915325667  SERIAL NOT NULL REFERENCES hv2_b7891567567,
    pnv20_b789153256672 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    PRIMARY KEY (pnv20_b78915325667, pnv20_b789153256672)

);
CREATE TABLE IF NOT EXISTS avatar pnv50_b78915325667(
    pnv2_b78915325667 SERIAL PRIMARY KEY,
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    name VARCHAR DEFAULT 'avatar.png'
    
);
CREATE TABLE IF NOT EXISTS vpnv2_b78915325667jet(
    pnv2_b78915325667 SERIAL PRIMARY KEY,
    upnv2_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    gpnv2_b78915325667 SERIAL NOT NULL REFERENCES groups,
    link VARCHAR(400) NOT NULL,
    issuedAt TIMESTAMP NOT NULL DEFAULT now() pnv52_b78915325667
    
);
CREATE TABLE IF NOT EXISTS timelinemess pnv53_b78915325667(
    upnv2_b78915325667_in SERIAL NOT NULL REFERENCES hv2_b7891567567,
    upnv2_b78915325667_out SERIAL NOT NULL REFERENCES hv2_b7891567567,
PRIMARY KEY (upnv2_b78915325667_in, upnv2_b78915325667_out)
);
CREATE TABLE IF NOT EXISTS impnv7_b78915325667s(
    pnv2_b78915325667 SERIAL PRIMARY KEY,
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    post_pnv2_b78915325667 SERIAL NOT NULL UNIQUE REFERENCES pnv19_b78915325667,
    name VARCHAR DEFAULT 'avatar.png'
    
);
  CREATE TABLE IF NOT EXISTS  messanges_noty pnv54_b78915325667 (
     pnv2_b78915325667 SERIAL NOT NULL PRIMARY KEY,
     value VARCHAR NOT NULL,
     messpnv7_b78915325667s VARCHAR NOT NULL,
     upnv2_b78915325667_In SERIAL NOT NULL REFERENCES hv2_b7891567567,
     actors1 VARCHAR[] NOT NULL,
     actors2 VARCHAR[] NOT NULL,
     upnv2_b78915325667_Out SERIAL NOT NULL REFERENCES hv2_b7891567567,
     created_at TIMESTAMP NOT NULL DEFAULT now()

);
  CREATE TABLE IF NOT EXISTS  messanges_gp pnv55_b78915325667 (
     pnv2_b78915325667 SERIAL NOT NULL PRIMARY KEY,
     messpnv7_b78915325667s VARCHAR NOT NULL,
     upnv2_b78915325667_In SERIAL NOT NULL REFERENCES hv2_b7891567567,
     gpnv2_b78915325667 SERIAL NOT NULL REFERENCES groups,
     created_at TIMESTAMP NOT NULL DEFAULT now()
);
CREATE TABLE IF NOT EXISTS notifications pnv56_b78915325667 (
    pnv2_b78915325667 SERIAL NOT NULL,
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    actors VARCHAR[] NOT NULL,
    type VARCHAR NOT NULL,
    post_pnv2_b78915325667 BIGINT REFERENCES pnv19_b78915325667,
    pnv20_b789153256672 BIGINT REFERENCES hv2_b7891567567,
    read_at TIMESTAMPTZ,
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
CREATE TABLE IF NOT EXISTS notificationz pnv57_b78915325667 (
    pnv2_b78915325667 SERIAL NOT NULL,
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    actors VARCHAR[] NOT NULL,
    type VARCHAR NOT NULL,
    post_pnv2_b78915325667 BIGINT REFERENCES pnv19_b78915325667,
    pnv20_b789153256672 BIGINT REFERENCES hv2_b7891567567,
    read_at TIMESTAMPTZ,
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS messanges_notyfi (
    pnv2_b78915325667 SERIAL NOT NULL,
    value VARCHAR NOT NULL,
    messpnv7_b78915325667s VARCHAR NOT NULL,
    upnv2_b78915325667_in BIGINT REFERENCES hv2_b7891567567,
    upnv2_b78915325667_out BIGINT REFERENCES hv2_b7891567567,
    read_at VARCHAR(15),
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
CREATE TABLE IF NOT EXISTS orderzz pnv58_b78915325667 (
    pnv2_b78915325667 SERIAL NOT NULL,
    ppnv2_b78915325667 BIGINT REFERENCES pnv19_b78915325667,
    upnv2_b78915325667 BIGINT REFERENCES hv2_b7891567567,
    upnv2_b78915325667m BIGINT REFERENCES hv2_b7891567567,
    gpnv2_b78915325667 BIGINT REFERENCES groups,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
CREATE TABLE IF NOT EXISTS tags (
    pnv2_b78915325667 SERIAL NOT NULL  PRIMARY KEY,
    tag VARCHAR NOT NULL,
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
CREATE TABLE IF NOT EXISTS tagss (
    pnv2_b78915325667 SERIAL NOT NULL  PRIMARY KEY,
    tag VARCHAR NOT NULL,
    UNIQUE(tag),
    ppnv2_b78915325667 BIGINT  NOT NULL,
    upnv2_b78915325667 BIGINT REFERENCES hv2_b7891567567,
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
CREATE TABLE  tags_relation (
    tpnv2_b78915325667 SERIAL  NOT NULL,
    ppnv2_b78915325667 SERIAL  NOT NULL 
);

CREATE TABLE IF NOT EXISTS gpall pnv60_b78915325667 (
    pnv2_b78915325667 SERIAL NOT NULL  PRIMARY KEY,
    value VARCHAR,
    type VARCHAR NOT NULL,
    upnv2_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    upnv2_b789153256672 SERIAL REFERENCES hv2_b7891567567,
    ppnv2_b78915325667 SERIAL,
    gpnv2_b78915325667 SERIAL,
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    modcl varchar  not Null
);

CREATE TABLE  groupU pnv61_b78915325667 (
     pnv2_b78915325667 SERIAL NOT NULL  PRIMARY KEY,
    upnv2_b78915325667 SERIAL  NOT NULL REFERENCES hv2_b7891567567,
    gpnv2_b78915325667 SERIAL  NOT NULL 
);

CREATE TABLE IF NOT EXISTS notificationsMess (
    pnv2_b78915325667 SERIAL NOT NULL,
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    actors VARCHAR[] NOT NULL,
    type VARCHAR NOT NULL,
    pnv20_b789153256672 SERIAL REFERENCES hv2_b7891567567,
    read_at TIMESTAMPTZ,
    issued_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS userGp  pnv62_b78915325667(
    upnv2_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    gpnv2_b78915325667 SERIAL NOT NULL REFERENCES groups,
PRIMARY KEY (upnv2_b78915325667, gpnv2_b78915325667)
);
CREATE INDEX IF NOT EXISTS sported_pnv19_b78915325667 ON pnv19_b78915325667 (created_at DESC);
 CREATE TABLE IF NOT EXISTS timeline (
      pnv2_b78915325667 SERIAL PRIMARY KEY,
       pnv20_b78915325667  SERIAL NOT NULL REFERENCES hv2_b7891567567,
    post_pnv2_b78915325667 SERIAL NOT NULL
 );
 CREATE TABLE IF NOT EXISTS post_subscriptions (
    pnv20_b78915325667 SERIAL NOT NULL REFERENCES hv2_b7891567567,
    post_pnv2_b78915325667 SERIAL NOT NULL,
    PRIMARY KEY (pnv20_b78915325667, post_pnv2_b78915325667)
 );
 CREATE UNIQUE INDEX IF NOT EXISTS timeline_unique ON timeline (pnv20_b78915325667, post_pnv2_b78915325667);



/*INSERT INTO hv2_b7891567567 (pnv2_b78915325667, pnv3_b78915325667, pnv4_b78915325667) VALUES 
(1, 'JOHN', 'alex@ya.com'),
(2, 'Jina', 'jinna@ya.com');*/
CREATE UNIQUE INDEX unique_notifications ON notifications (pnv20_b78915325667, type, post_pnv2_b78915325667, read_at, pnv20_b789153256672  );
/*
INSERT INTO avatar (pnv2_b78915325667, pnv20_b78915325667, name) 
VALUES (1, 589787864940871681, '1500x500.jpeg');
ALTER TABLE notifications ALTER COLUMN post_pnv2_b78915325667 TYPE BIGINT;
*/
/*
INSERT INTO avatar ( "pnv20_b78915325667", "name") VALUES ( 592939641249497089, 'avatar.png') ON CONFLICT (pnv2_b78915325667) DO UPDATE SET name = 'avatar.png';

INSERT INTO avatar ( pnv20_b78915325667, name) VALUES ( 592939641249497089, 'avatar.png') ON DUPLICATE KEY UPDATE pnv20_b78915325667 = 592939641249497089, name = 'avatar.png';

SELECT hv2_b7891567567.pnv2_b78915325667, pnv3_b78915325667, pnv16_b78915325667, pnv18_b78915325667,  followers.follwer_pnv2_b78915325667 IS NOT NULL AS following, followees.follwee_pnv2_b78915325667 IS NOT NULL AS followeed, avatar.name FROM hv2_b7891567567 LEFT JOIN follows AS followers ON followers.follwer_pnv2_b78915325667 = 589787864940871681 AND followers.follwee_pnv2_b78915325667 = hv2_b7891567567.pnv2_b78915325667 LEFT JOIN follows AS followees ON followees.follwer_pnv2_b78915325667 = hv2_b7891567567.pnv2_b78915325667 AND followees.follwee_pnv2_b78915325667 = 589787864940871681 LEFT JOIN avatar ON avatar.pnv20_b78915325667 = avatar.pnv20_b78915325667  AND avatar.pnv20_b78915325667 = 589787864940871681 WHERE pnv4_b78915325667 = 'alex';
SELECT hv2_b7891567567.pnv2_b78915325667, pnv3_b78915325667, pnv16_b78915325667, pnv18_b78915325667,  followers.follwer_pnv2_b78915325667 IS NOT NULL AS following, followees.follwee_pnv2_b78915325667 IS NOT NULL AS followeed FROM hv2_b7891567567 LEFT JOIN follows AS followers ON followers.follwer_pnv2_b78915325667 = 589787864940871681 AND followers.follwee_pnv2_b78915325667 = hv2_b7891567567.pnv2_b78915325667 LEFT JOIN follows AS followees ON followees.follwer_pnv2_b78915325667 = hv2_b7891567567.pnv2_b78915325667 AND followees.follwee_pnv2_b78915325667 = 589787864940871681 LEFT JOIN avatar ON avatar.pnv20_b78915325667 = avatar.pnv20_b78915325667  AND avatar.pnv20_b78915325667 = 589787864940871681 WHERE pnv4_b78915325667 = 'alex';
*/